<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji & Stil QR OluÅŸturucu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        h2 { margin-top: 0; color: #2c3e50; }

        .input-group { margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: #555; }
        
        input[type="text"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
            transition: 0.3s;
        }
        input:focus, select:focus { border-color: #333; outline: none; }

        /* Emoji GiriÅŸ AlanÄ± Ã–zel Stil */
        #emojiInput {
            font-size: 24px;
            text-align: center;
            letter-spacing: 5px;
        }

        button {
            background: #222;
            color: white;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        button.download { background: #e91e63; display: none; }
        button:hover { opacity: 0.9; }

        .preview-box {
            margin-top: 20px;
            padding: 10px;
            background: white;
            border: 1px dashed #ccc;
            border-radius: 10px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        canvas { max-width: 100%; height: auto; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ðŸ–¤ Emoji QR Mozaik</h2>
        
        <div class="input-group">
            <label>ðŸ”— Web Sitesi / Link:</label>
            <input type="text" id="urlInput" placeholder="https://..." value="https://instagram.com">
        </div>

        <div class="input-group" style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>ðŸ˜€ Emoji SeÃ§:</label>
                <input type="text" id="emojiInput" value="â¤ï¸" placeholder="Emoji yapÄ±ÅŸtÄ±r" maxlength="2">
            </div>
            <div style="flex: 1;">
                <label>ðŸ”² KÃ¶ÅŸe Stili:</label>
                <select id="cornerStyle">
                    <option value="square">Klasik Kare</option>
                    <option value="rounded">YumuÅŸak (Rounded)</option>
                    <option value="circle">Tam Daire</option>
                    <option value="leaf">Yaprak (Leaf)</option>
                </select>
            </div>
        </div>

        <button onclick="generateEmojiQR()">âœ¨ SÄ°HÄ°RLÄ° QR OLUÅžTUR</button>
        <button class="download" id="dlBtn" onclick="downloadPDF()">ðŸ’¾ 40x30cm PDF Ä°NDÄ°R</button>

        <div class="preview-box" id="previewContainer">
            <span style="color:#aaa;">Ã–nizleme burada Ã§Ä±kacak...</span>
        </div>
    </div>

    <script>
        // 40cm x 30cm @ 300 DPI
        const PRINT_W = 4724;
        const PRINT_H = 3543;
        let qrMatrix = null;
        
        function generateEmojiQR() {
            let url = document.getElementById("urlInput").value;
            let emoji = document.getElementById("emojiInput").value || "â¬›"; // Emoji girilmezse kare yap
            
            if(!url) return alert("Link girmeyi unuttun!");

            // 1. QR Matrisini Hesapla
            let type = 0; // Auto
            let err = 'H'; // YÃ¼ksek Hata DÃ¼zeltme (Emoji ÅŸekilleri bozsa bile okunsun diye)
            let qr = qrcode(type, err);
            qr.addData(url);
            qr.make();
            qrMatrix = qr;

            // 2. Canvas HazÄ±rla
            let container = document.getElementById("previewContainer");
            container.innerHTML = "";
            let canvas = document.createElement("canvas");
            // Ã–nizleme iÃ§in makul bir boyut
            canvas.width = 800;
            canvas.height = 800; 
            container.appendChild(canvas);

            // 3. Ã‡izimi BaÅŸlat
            drawCanvas(canvas, 800, emoji);
            
            // Ä°ndirme butonunu aÃ§
            document.getElementById("dlBtn").style.display = "block";
        }

        function drawCanvas(canvas, size, emoji) {
            let ctx = canvas.getContext("2d");
            let count = qrMatrix.getModuleCount();
            let tileSize = size / count; // Her bir kareciÄŸin boyutu

            // Temizle (Beyaz Arka Plan)
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, size, size);

            // KÃ¶mÃ¼r SiyahÄ± Efekti Ä°Ã§in Ayar
            // Emojiler normalde renklidir. Canvas filtreleri ile siyah-beyaz yapÄ±p karartacaÄŸÄ±z.
            ctx.filter = "grayscale(100%) brightness(0%) contrast(200%)"; 
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            // Font boyutunu karenin biraz fazlasÄ± yapalÄ±m ki dolgun dursun
            ctx.font = `${tileSize * 1.0}px Arial`; 

            let cornerStyle = document.getElementById("cornerStyle").value;

            for (let r = 0; r < count; r++) {
                for (let c = 0; c < count; c++) {
                    // Bu nokta QR'Ä±n parÃ§asÄ± mÄ±?
                    if (qrMatrix.isDark(r, c)) {
                        
                        // KÃ–ÅžE (FINDER PATTERN) KONTROLÃœ
                        // QR kodun 3 kÃ¶ÅŸesindeki bÃ¼yÃ¼k gÃ¶zleri tespit etmemiz lazÄ±m.
                        // Sol Ãœst (0-7), SaÄŸ Ãœst (count-7), Sol Alt (0-7)
                        let isFinder = false;
                        if ((r < 7 && c < 7) || (r < 7 && c >= count - 7) || (r >= count - 7 && c < 7)) {
                            isFinder = true;
                        }

                        if (isFinder) {
                            // KÃ¶ÅŸeleri ayrÄ±ca Ã§izeceÄŸiz, o yÃ¼zden dÃ¶ngÃ¼de atlÄ±yoruz.
                            // (AÅŸaÄŸÄ±da drawFinders fonksiyonu Ã§izecek)
                        } else {
                            // VERÄ° ALANI: Buraya Emoji basÄ±yoruz!
                            let x = c * tileSize + tileSize / 2;
                            let y = r * tileSize + tileSize / 2 + (tileSize * 0.1); // Hafif aÅŸaÄŸÄ± ofset
                            ctx.fillText(emoji, x, y);
                        }
                    }
                }
            }

            // Filtreyi kapat (KÃ¶ÅŸeleri net siyah Ã§izeceÄŸiz, emoji deÄŸil)
            ctx.filter = "none";
            drawFinders(ctx, size, count, cornerStyle);
        }

        // --- Ã–ZEL KÃ–ÅžE Ã‡Ä°ZÄ°CÄ° (GÃ–ZLER) ---
        function drawFinders(ctx, totalSize, count, style) {
            let tileSize = totalSize / count;
            let finderSize = tileSize * 7; // GÃ¶zler her zaman 7x7 birimdir

            // 3 Pozisyon: Sol-Ãœst, SaÄŸ-Ãœst, Sol-Alt
            let positions = [
                [0, 0], 
                [totalSize - finderSize, 0], 
                [0, totalSize - finderSize]
            ];

            ctx.fillStyle = "#000000"; // KÃ¶mÃ¼r SiyahÄ±

            positions.forEach(pos => {
                let x = pos[0];
                let y = pos[1];
                let s = finderSize;
                
                // DÄ±ÅŸ Ã‡erÃ§eve
                drawShape(ctx, x, y, s, style, true);
                
                // Ä°Ã§indeki Beyaz BoÅŸluk (Frame kalÄ±nlÄ±ÄŸÄ± genelde 1 birimdir)
                ctx.fillStyle = "#ffffff";
                let innerGap = tileSize; 
                drawShape(ctx, x + innerGap, y + innerGap, s - innerGap*2, style, false);

                // En Ä°Ã§teki Siyah Nokta (3x3 birim)
                ctx.fillStyle = "#000000";
                let centerDot = tileSize * 2;
                drawShape(ctx, x + centerDot, y + centerDot, s - centerDot*2, style, true);
            });
        }

        // Åžekil Ã‡izim MantÄ±ÄŸÄ±
        function drawShape(ctx, x, y, size, style, fill) {
            ctx.beginPath();
            
            if (style === "square") {
                ctx.rect(x, y, size, size);
            } 
            else if (style === "circle") {
                let r = size / 2;
                ctx.arc(x + r, y + r, r, 0, Math.PI * 2);
            } 
            else if (style === "rounded") {
                // KÃ¶ÅŸeleri yuvarlatÄ±lmÄ±ÅŸ kare
                let r = size * 0.2; // Yuvarlatma oranÄ±
                ctx.roundRect(x, y, size, size, r);
            } 
            else if (style === "leaf") {
                // Yaprak efekti: Ä°ki kÃ¶ÅŸe yuvarlak, iki kÃ¶ÅŸe sivri
                let r = size * 0.5;
                ctx.moveTo(x, y); // Sol Ã¼st sivri
                ctx.lineTo(x + size, y); 
                ctx.arcTo(x + size, y + size, x, y + size, r); // SaÄŸ alt yuvarlak
                ctx.lineTo(x, y + size);
                ctx.arcTo(x, y, x + size, y, r); // Sol alt yuvarlak
                // Bu biraz basit yaprak oldu, CSS border-radius mantÄ±ÄŸÄ± gibi:
                // ctx.roundRect(x, y, size, size, [0, size/2, 0, size/2]); // Sadece modern tarayÄ±cÄ±larda Ã§alÄ±ÅŸÄ±r
                // Garanti yÃ¶ntem:
                ctx.roundRect(x, y, size, size, [size/2, 0, size/2, 0]); 
            }
            
            ctx.fill();
        }

        // --- Ä°NDÄ°RME FONKSÄ°YONU ---
        function downloadPDF() {
            let btn = document.getElementById("dlBtn");
            btn.innerText = "â³ HazÄ±rlanÄ±yor...";

            setTimeout(() => {
                // 1. BÃ¼yÃ¼k Canvas OluÅŸtur
                let bigCanvas = document.createElement("canvas");
                // PDF'in iÃ§ine tam sÄ±ÄŸacak en yÃ¼ksek kalite (yaklaÅŸÄ±k 4000px)
                let size = 2000; 
                bigCanvas.width = size;
                bigCanvas.height = size;
                
                let emoji = document.getElementById("emojiInput").value || "â¬›";
                drawCanvas(bigCanvas, size, emoji);

                // 2. PDF OluÅŸtur (40x30 cm Yatay)
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: "landscape",
                    unit: "cm",
                    format: [40, 30]
                });

                // QR Kodu ortaya yerleÅŸtir (Kare olduÄŸu iÃ§in 30cm yÃ¼ksekliÄŸe sÄ±ÄŸdÄ±racaÄŸÄ±z)
                // 40cm geniÅŸlik var, 30cm yÃ¼kseklik. Ortalamak iÃ§in soldan 5cm boÅŸluk bÄ±rakÄ±yoruz.
                let imgData = bigCanvas.toDataURL("image/jpeg", 1.0);
                pdf.addImage(imgData, 'JPEG', 5, 0, 30, 30); // x=5, y=0, w=30, h=30

                pdf.save("Emoji_QR_Mozaik.pdf");
                btn.innerText = "ðŸ’¾ 40x30cm PDF Ä°NDÄ°R";
            }, 100);
        }
    </script>
</body>
</html>
