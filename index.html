<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkÄ±ÅŸkan Sanat QR - 40x30</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        .controls {
            width: 100%;
            max-width: 500px;
            background: #111;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        input, button, select {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            font-size: 16px;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            background: #00ff99;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        
        button#dlBtn {
            background: #ff0055;
            color: #fff;
            display: none;
        }

        .preview-area {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
        }

        canvas {
            max-width: 100%;
            height: auto;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <div class="controls">
        <h2 style="margin-top:0; color:#00ff99;">ðŸ§ª SIVI/MÃœREKKEP QR</h2>
        
        <label>Hedef Link:</label>
        <input type="text" id="linkInput" value="https://instagram.com" placeholder="https://...">

        <label>Leke Rengi:</label>
        <input type="color" id="inkColor" value="#000000" style="height:50px;">
        
        <label>YoÄŸunluk:</label>
        <select id="density">
            <option value="low">Seyrek (Daha Sanatsal)</option>
            <option value="high">YoÄŸun (Daha GÃ¼venli)</option>
        </select>

        <button onclick="generateLiquidArt()">ðŸ”¥ SanatÄ± DÃ¶k</button>
        <button id="dlBtn" onclick="downloadPDF()">ðŸ’¾ 40x30cm PDF Ä°NDÄ°R</button>
    </div>

    <div class="preview-area" id="previewBox">
        </div>

    <script>
        // 40cm x 30cm @ 300 DPI
        const FULL_WIDTH = 4724; 
        const FULL_HEIGHT = 3543;
        
        let currentQR = null;
        let uniqueCode = "";

        function generateLiquidArt() {
            let url = document.getElementById("linkInput").value;
            if(!url) return alert("Link gir!");

            // 1. UNIQUE ID EKLE (Her seferinde farklÄ± desen iÃ§in)
            uniqueCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            let finalUrl = url.includes("?") ? `${url}&id=${uniqueCode}` : `${url}?id=${uniqueCode}`;

            // 2. QR DATASINI HESAPLA
            // TypeNumber: 0 (Otomatik), Correction: H (YÃ¼ksek - Leke olsa da okunur)
            let typeNumber = 0;
            let errorCorrectionLevel = 'H';
            let qr = qrcode(typeNumber, errorCorrectionLevel);
            qr.addData(finalUrl);
            qr.make();
            currentQR = qr;

            // 3. Ã–NÄ°ZLEME Ã‡Ä°Z
            let previewContainer = document.getElementById("previewBox");
            previewContainer.innerHTML = ""; // Temizle
            
            let canvas = document.createElement("canvas");
            canvas.id = "artCanvas";
            previewContainer.style.display = "block";
            previewContainer.appendChild(canvas);

            // Ã–nizleme boyutu (KÃ¼Ã§Ã¼k)
            drawArt(canvas, 800, 600);
            
            // Ä°ndirme butonunu aÃ§
            let dlBtn = document.getElementById("dlBtn");
            dlBtn.style.display = "block";
            dlBtn.innerText = `ðŸ’¾ 40x30cm PDF Ä°NDÄ°R (${uniqueCode})`;
        }

        function drawArt(canvas, width, height) {
            let ctx = canvas.getContext("2d");
            canvas.width = width;
            canvas.height = height;

            // Arka plan BEYAZ (Kontrast iÃ§in ÅŸart)
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, width, height);

            let moduleCount = currentQR.getModuleCount();
            let color = document.getElementById("inkColor").value;
            
            // QR Kodun yerleÅŸimi (Ortada %70 yer kaplasÄ±n)
            let size = Math.min(width, height) * 0.7;
            let startX = (width - size) / 2;
            let startY = (height - size) / 2;
            let tileSize = size / moduleCount;

            ctx.fillStyle = color;

            for (let r = 0; r < moduleCount; r++) {
                for (let c = 0; c < moduleCount; c++) {
                    if (currentQR.isDark(r, c)) {
                        let x = startX + c * tileSize;
                        let y = startY + r * tileSize;
                        
                        // BURASI SÄ°HÄ°RÄ°N OLDUÄžU YER:
                        // Kare Ã§izmek yerine "AkÄ±ÅŸkan Leke" fonksiyonunu Ã§aÄŸÄ±rÄ±yoruz.
                        drawLiquidDrop(ctx, x, y, tileSize);
                    }
                }
            }
            
            // AltÄ±na Kod YazÄ±sÄ±
            ctx.fillStyle = "#ccc";
            ctx.font = "12px monospace";
            ctx.fillText(uniqueCode, 10, height - 10);
        }

        function drawLiquidDrop(ctx, x, y, size) {
            // Rastgele ÅŸekil parametreleri
            let cx = x + size / 2;
            let cy = y + size / 2;
            let radius = (size / 2) * 1.3; // Biraz taÅŸsÄ±n ki birleÅŸsinler (MÃ¼rekkep etkisi)

            ctx.beginPath();
            
            // Basit bir daire yerine bozuk bir Ã§okgen Ã§iziyoruz (Leke efekti)
            // Nokta sayÄ±sÄ±nÄ± ve aÃ§Ä±yÄ± rastgele deÄŸiÅŸtirerek organiklik katÄ±yoruz
            let points = 6 + Math.floor(Math.random() * 4); // 6-10 arasÄ± kÃ¶ÅŸe
            
            for (let i = 0; i <= points; i++) {
                let angle = (i / points) * Math.PI * 2;
                // YarÄ±Ã§apÄ± rastgele daraltÄ±p geniÅŸletiyoruz (%80 ile %120 arasÄ±)
                let r = radius * (0.8 + Math.random() * 0.4); 
                let px = cx + Math.cos(angle) * r;
                let py = cy + Math.sin(angle) * r;
                
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            
            ctx.closePath();
            ctx.fill();
        }

        async function downloadPDF() {
            let btn = document.getElementById("dlBtn");
            btn.innerText = "â³ HAZIRLANIYOR...";
            
            setTimeout(() => {
                // 1. YÃ¼ksek Ã‡Ã¶zÃ¼nÃ¼rlÃ¼klÃ¼ Canvas OluÅŸtur
                let bigCanvas = document.createElement("canvas");
                drawArt(bigCanvas, FULL_WIDTH, FULL_HEIGHT);
                
                // 2. PDF'e Ã‡evir
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: "landscape",
                    unit: "mm",
                    format: [400, 300] // 40cm x 30cm
                });

                let imgData = bigCanvas.toDataURL("image/jpeg", 1.0);
                pdf.addImage(imgData, 'JPEG', 0, 0, 400, 300);
                pdf.save(`Murekkep_QR_${uniqueCode}.pdf`);
                
                btn.innerText = "âœ… Ä°NDÄ°RÄ°LDÄ°";
                setTimeout(() => btn.innerText = `ðŸ’¾ 40x30cm PDF Ä°NDÄ°R`, 2000);
            }, 100);
        }
    </script>
</body>
</html>
