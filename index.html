<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Emoji QR Olu≈üturucu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #121212; /* Koyu Tema */
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px; /* Telefon ekranƒ±na uygun */
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        h2 { text-align: center; color: #00e676; margin-top: 0; }

        label {
            display: block;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #aaa;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            background: #2c2c2c;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Emoji Giri≈üi Ortada ve B√ºy√ºk */
        #emojiInput {
            text-align: center;
            font-size: 24px;
            letter-spacing: 5px;
        }

        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .btn-gen { background: #00e676; color: #000; }
        .btn-pdf { background: #ff4081; color: #fff; display: none; margin-top: 10px; }
        .btn-img { background: #2979ff; color: #fff; display: none; margin-top: 10px; }

        #previewContainer {
            margin-top: 20px;
            background: #fff;
            padding: 10px;
            border-radius: 12px;
            display: none;
            text-align: center;
        }

        canvas {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>üñ§ PRO QR STUDIO</h2>
        
        <label>üîó Hedef Link:</label>
        <input type="text" id="urlInput" value="https://instagram.com" placeholder="https://...">

        <div class="row">
            <div class="col">
                <label>üòÄ Desen (Emoji):</label>
                <input type="text" id="emojiInput" value="‚ù§Ô∏è" placeholder="Emoji">
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>üî≤ Dƒ±≈ü √áer√ßeve:</label>
                <select id="frameStyle">
                    <option value="square">Kare (Klasik)</option>
                    <option value="rounded">Yumu≈üak</option>
                    <option value="circle">Yuvarlak</option>
                    <option value="leaf">Yaprak</option>
                </select>
            </div>
            <div class="col">
                <label>‚ö´ ƒ∞√ß Nokta:</label>
                <select id="dotStyle">
                    <option value="square">Kare</option>
                    <option value="circle">Yuvarlak</option>
                    <option value="diamond">Elmas</option>
                </select>
            </div>
        </div>

        <button class="btn-gen" onclick="generateQR()">‚ú® Tasarƒ±mƒ± Olu≈ütur</button>
        
        <div id="previewContainer">
            <canvas id="qrCanvas"></canvas>
        </div>

        <button class="btn-pdf" id="btnPdf" onclick="downloadPDF()">üìÑ PDF Olarak ƒ∞ndir</button>
        <button class="btn-img" id="btnImg" onclick="downloadImage()">üñºÔ∏è Galeriye Kaydet (JPG)</button>
    </div>

    <script>
        let qrMatrix = null;
        // √áƒ±ktƒ± kalitesi (Piksel cinsinden kenar uzunluƒüu)
        const OUTPUT_SIZE = 2000; 

        function generateQR() {
            let url = document.getElementById("urlInput").value;
            let emoji = document.getElementById("emojiInput").value || "‚¨õ";
            
            if(!url) return alert("Link girilmeli!");

            // 1. QR Matematiksel Hesaplama
            let type = 0; // Otomatik
            let err = 'H'; // Y√ºksek Hata D√ºzeltme (G√∂rsel bozulmasƒ±n diye)
            let qr = qrcode(type, err);
            qr.addData(url);
            qr.make();
            qrMatrix = qr;

            // 2. √ñnizleme
            let canvas = document.getElementById("qrCanvas");
            let container = document.getElementById("previewContainer");
            
            // Canvasƒ± √ßiz
            drawQR(canvas, 1000, emoji); // √ñnizleme i√ßin 1000px yeterli
            
            container.style.display = "block";
            document.getElementById("btnPdf").style.display = "block";
            document.getElementById("btnImg").style.display = "block";
        }

        function drawQR(canvas, size, emoji) {
            let ctx = canvas.getContext("2d");
            canvas.width = size;
            canvas.height = size;
            
            let count = qrMatrix.getModuleCount();
            let tileSize = size / count;

            // Arka Plan Beyaz
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, size, size);

            // Ayarlarƒ± Al
            let frameStyle = document.getElementById("frameStyle").value;
            let dotStyle = document.getElementById("dotStyle").value;

            // K√∂m√ºr Siyahƒ± Modu
            ctx.fillStyle = "#000000"; 
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.font = `${tileSize * 1.05}px Arial`; // Emoji boyutu

            for (let r = 0; r < count; r++) {
                for (let c = 0; c < count; c++) {
                    if (qrMatrix.isDark(r, c)) {
                        // K√∂≈üe Kontrol√º (Finder Patterns)
                        // 3 K√∂≈üedeki 7x7'lik alanlarƒ± tespit et
                        let isFinder = false;
                        if ((r < 7 && c < 7) || (r < 7 && c >= count - 7) || (r >= count - 7 && c < 7)) {
                            isFinder = true;
                        }

                        if (isFinder) {
                            // K√∂≈üeleri burada √ßizmiyoruz, fonksiyonun sonunda toplu √ßizeceƒüiz
                            // ki emojilerle karƒ±≈ümasƒ±n.
                        } else {
                            // Veri Alanƒ± -> EMOJƒ∞ BAS (Siyah Filtreli)
                            // Canvas filter kullanarak emojiyi simsiyah yapƒ±yoruz
                            ctx.save();
                            ctx.filter = "grayscale(100%) brightness(0%)"; 
                            let x = c * tileSize + tileSize / 2;
                            let y = r * tileSize + tileSize / 2 + (tileSize*0.1); 
                            ctx.fillText(emoji, x, y);
                            ctx.restore();
                        }
                    }
                }
            }

            // K√ñ≈ûELERƒ∞ √áƒ∞Z (Frame ve Dot ayrƒ± stillerde)
            drawFinderPatterns(ctx, size, count, tileSize, frameStyle, dotStyle);
        }

        function drawFinderPatterns(ctx, size, count, tileSize, frameStyle, dotStyle) {
            let finderSize = tileSize * 7; // G√∂z boyutu 7 birimdir
            // Pozisyonlar: Sol-√úst, Saƒü-√úst, Sol-Alt
            let pos = [
                {x: 0, y: 0},
                {x: size - finderSize, y: 0},
                {x: 0, y: size - finderSize}
            ];

            ctx.fillStyle = "#000000"; // Siyah

            pos.forEach(p => {
                // 1. DI≈û √áER√áEVE (Frame)
                drawShape(ctx, p.x, p.y, finderSize, frameStyle);
                
                // 2. ORTA BEYAZ BO≈ûLUK (Temizle)
                ctx.save();
                ctx.fillStyle = "#ffffff";
                let gap = tileSize; // 1 birim kalƒ±nlƒ±k
                drawShape(ctx, p.x + gap, p.y + gap, finderSize - gap*2, frameStyle); // ƒ∞√ßini beyazlat
                ctx.restore();

                // 3. ƒ∞√á NOKTA (Dot) - Ayrƒ± stille
                let dotSize = tileSize * 3; // Nokta 3 birimdir
                let centerOffset = (finderSize - dotSize) / 2;
                drawShape(ctx, p.x + centerOffset, p.y + centerOffset, dotSize, dotStyle);
            });
        }

        // Geometrik ≈ûekil √áizici
        function drawShape(ctx, x, y, s, style) {
            ctx.beginPath();
            if (style === "square") {
                ctx.rect(x, y, s, s);
            } else if (style === "circle") {
                let r = s / 2;
                ctx.arc(x + r, y + r, r, 0, Math.PI * 2);
            } else if (style === "rounded") {
                ctx.roundRect(x, y, s, s, s * 0.25);
            } else if (style === "leaf") {
                ctx.roundRect(x, y, s, s, [s/2, 0, s/2, 0]);
            } else if (style === "diamond") {
                ctx.moveTo(x + s/2, y);
                ctx.lineTo(x + s, y + s/2);
                ctx.lineTo(x + s/2, y + s);
                ctx.lineTo(x, y + s/2);
                ctx.closePath();
            }
            ctx.fill();
        }

        // --- ƒ∞NDƒ∞RME ƒ∞≈ûLEMLERƒ∞ ---

        // 1. PDF ƒ∞NDƒ∞R (ƒ∞stediƒüin gibi)
        function downloadPDF() {
            let btn = document.getElementById("btnPdf");
            btn.innerText = "‚è≥ Hazƒ±rlanƒ±yor...";

            setTimeout(() => {
                let canvas = document.createElement("canvas");
                // Y√ºksek kalite √ßizim
                drawQR(canvas, 2000, document.getElementById("emojiInput").value || "‚¨õ");
                let imgData = canvas.toDataURL("image/jpeg", 1.0);

                const { jsPDF } = window.jspdf;
                // Standart Kare PDF
                const pdf = new jsPDF({
                    orientation: "portrait",
                    unit: "mm",
                    format: [200, 200] // 20cm x 20cm Kare PDF
                });

                pdf.addImage(imgData, 'JPEG', 0, 0, 200, 200);
                pdf.save("QR_Tasarim.pdf");
                
                btn.innerText = "üìÑ PDF Olarak ƒ∞ndir";
            }, 100);
        }

        // 2. GALERƒ∞ ƒ∞√áƒ∞N JPG ƒ∞NDƒ∞R (Telefonda daha kolay a√ßƒ±lƒ±r)
        function downloadImage() {
            let canvas = document.createElement("canvas");
            drawQR(canvas, 2000, document.getElementById("emojiInput").value || "‚¨õ");
            
            let link = document.createElement('a');
            link.download = 'QR_Tasarim.jpg';
            link.href = canvas.toDataURL("image/jpeg", 1.0);
            link.click();
        }
    </script>
</body>
</html>
